{
  "name": "SQL Server to Azure",
  "tagline": "Microsoft SQL Server CLR Azure Methods",
  "body": "# SQL Server to Azure\r\n#### Microsoft SQL Server CLR Azure Methods\r\n[![license](https://img.shields.io/github/license/mashape/apistatus.svg)](LICENSE)\r\n\r\n## Introduction\r\nWith the advent of Microsoft SQL Server 2012 SP1 CU2 Microsoft allows you to leverage many Windows Azure storage features right from SQL Server (such as backup/restore off an Azure blob).\r\nWith Microsoft SQL Server 2014 it will be possible to place datafiles and transaction logs directly in the Windows Azure containers as blobs. \r\n Many of those features, however, may require you to leave SSMS and resort to other means in order to control the Windows Azure platform. \r\n\r\n## Why SQL Server?\r\nThere are many libraries for Azure interaction. C#, PowerShell and so on. But what about SQL Server and its T-SQL? Since SQL Server 2014 the integration with Azure is good enough to warrant a dedicated library. \r\n\r\n* Do you want to enumerate your blobs? Query the relevant table! \r\n* Do you need to import/export from Azure tables in your SQL Server Database? Use a simple ```SELECT INTO```!\r\n* Need to push events to an Azure Queue? Call a simple stored procedure!\r\n\r\n### Examples\r\nFor example, as detailed in this Igor Pagliaiâ€™s post ([http://blogs.msdn.com/b/igorpag/archive/2013/10/23/create-a-sql-server-2014-database-directly-on-azure-blob-storage-with-sqlxi.aspx](http://blogs.msdn.com/b/igorpag/archive/2013/10/23/create-a-sql-server-2014-database-directly-on-azure-blob-storage-with-sqlxi.aspx)), you cannot break blob leases using SQL Server. With this CLR library, all you have to do is to call the right stored procedure: \r\n```SQL\r\nEXEC [Azure].BreakBlobLeaseImmediately  \r\n\t'AccountName',\r\n\t'SharedKey',\r\n\t1,\r\n\t'ContainerName',\r\n\t'BlobName'\r\n```\r\nAnd you are ready to go :).\r\n\r\nAs another example, with this code you enumerate all your containers:\r\n```SQL\r\nSELECT * FROM  [Azure].ListContainers(\r\n\t'AccountName', \r\n\t'SharedKey', \r\n\t1, \r\n\tNULL);\t\t\t\r\n```\r\n\r\nEach container can be enumerated too:\r\n\r\n```SQL\r\nSELECT * FROM  [Azure].ListBlobs(\r\n\t'AccountName', \r\n        'SharedKey', \r\n\t1, \r\n\t'ContainerName',\t\t\r\n\t1,\t\t\t\t\t\t\r\n\t1,\t\t\t\t\t\t\r\n\t1,\t\t\t\t\r\n\t1,\t\t\t\t\t\t\r\n\tNULL);\t\t\t\t\r\n```\r\n\r\nMore examples here: [TechNet Blogs: Italian Premier Center for SQL Server](http://blogs.technet.com/b/italian_premier_center_for_sql_server/) or in my MSDN blog [http://blogs.msdn.com/b/frcogno](http://blogs.msdn.com/b/frcogno).\r\n\r\n\r\n*Feel free to contribute with ideas!* :)\r\n\r\n### About the Windows Azure REST API from SQLCLR\r\nThis library will allow you to work with blobs, tables and queues, to handle ACLs and metadata. \r\n\r\nI recently had a session at SQLRally Amsterdam about this topic, as soon as the video becomes available I will add it here.\r\n\r\nRight now it supports:\r\n* [Windows Azure Queue storage](http://msdn.microsoft.com/en-us/library/windowsazure/dd179363.aspx).\r\n* [Windows Azure Table storage](http://msdn.microsoft.com/en-us/library/windowsazure/dd179423.aspx).\r\n* [Windows Azure blob storage](http://msdn.microsoft.com/en-us/library/windowsazure/dd135733.aspx) (both page and block).\r\n\r\nThere are still missing functionality. For example the [Put block list](http://msdn.microsoft.com/en-us/library/windowsazure/dd179467.aspx) functionality is not implemented yet.\r\n\r\nNote that the library target is framework 4.5 so it will work out of the box with Microsoft SQL Server 2012/2014. If you need to use it with any previous SQL Server version you might need to recompile it. \r\n\r\n### How to try it\r\nIn a nutshell, all you have to do is:\r\n\r\n1. Download/clone the code and compile it.\r\n2. Put the DLLs into a convenient location (ie reachable from Microsoft SQL Server).\r\n3. Run the following script but make sure to replace the parameters first (ie with CTRL-Shift-M in SSMS).\r\n4. Map the SQLCLR functions/SPs to the corresponding T-SQL ones. For that, you can use the [Creation.sql script](https://github.com/MindFlavor/sqlservertoazure/blob/master/ITPCfSQL.Azure.CLR/SQL.Scripts/Creation.sql) shipped with the library.\r\n\r\n```SQL\r\nCREATE ASYMMETRIC KEY ['<asymmetric_key_name, sysname, SampleAzureKey>'] FROM EXECUTABLE FILE = '<full_file_path, nvarchar(4000), Enter the full DLL path>'\r\nCREATE LOGIN ['<asymmetric_login_name, sysname, SampleAzureLogin>'] FROM ASYMMETRIC KEY ['<asymmetric_key_name, sysname, SampleAzureKey>'];\r\n\r\nGRANT EXTERNAL ACCESS ASSEMBLY TO ['<asymmetric_login_name, sysname, SampleAzureLogin>'];\r\nGO\r\n\r\nCREATE ASSEMBLY [ITPCfSQL.Azure.CLR] FROM '<full_file_path, nvarchar(4000), Enter the full DLL path>'\r\nWITH PERMISSION_SET=EXTERNAL_ACCESS;\r\nGO\r\n```\r\n\r\n### License\r\n\r\nPlease see [LICENSE](https://github.com/MindFlavor/sqlservertoazure/blob/master/LICENSE) file.\r\n\r\nHappy Coding,\r\n[Francesco Cogno](mailto:francesco.cogno@outlook.com).\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}